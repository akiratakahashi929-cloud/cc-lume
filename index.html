<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
/* ============================================================
   CC Lume â€” Luminance Premium System (Ui_Style.css)
   Clean Luminance / Liquid Flow / Modern Command
   ============================================================ */

  /* === ãƒªã‚»ãƒƒãƒˆãƒ»ãƒ™ãƒ¼ã‚¹ === */
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  html {
    font-size: 15px;
  }

  body {
    font-family: 'Helvetica Neue', 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', 'Meiryo', sans-serif;
    background: #FDFDFF;
    /* Milky White */
    color: #0A0A1F;
    /* Modern Command Navy */
    min-height: 100vh;
    overflow-x: hidden;
    line-height: 1.6;
    position: relative;
  }

  /* === Layer 2: Motion Layer (Liquid Flow) === */
  body::before,
  body::after {
    content: "";
    position: fixed;
    top: -50%;
    left: -50%;
    width: 200%;
    height: 200%;
    z-index: -1;
    pointer-events: none;
    opacity: 0.15;
    /* ç©ºæ°—ã®ã‚ˆã†ãªå­˜åœ¨æ„Ÿ */
    filter: blur(80px);
    animation: liquidFlow 25s infinite alternate ease-in-out;
  }

  body::before {
    background: radial-gradient(circle at 30% 30%, #00FFFF 0%, transparent 50%);
    /* Cyan */
  }

  body::after {
    background: radial-gradient(circle at 70% 70%, #FF00FF 0%, transparent 50%);
    /* Magenta */
    animation-delay: -10s;
  }

  @keyframes liquidFlow {
    0% {
      transform: translate(0, 0) rotate(0deg) scale(1);
    }

    50% {
      transform: translate(5%, 10%) rotate(5deg) scale(1.1);
    }

    100% {
      transform: translate(-5%, -5%) rotate(-5deg) scale(1);
    }
  }

  /* === å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ === */
  .hidden {
    display: none !important;
  }

  .text-center {
    text-align: center;
  }

  .mt-1 {
    margin-top: 0.5rem;
  }

  .mt-2 {
    margin-top: 1rem;
  }

  .mt-3 {
    margin-top: 1.5rem;
  }

  .mb-1 {
    margin-bottom: 0.5rem;
  }

  .mb-2 {
    margin-bottom: 1rem;
  }

  /* === ç”»é¢ã‚³ãƒ³ãƒ†ãƒŠ === */
  .screen {
    display: none;
    min-height: 100vh;
    padding: 2rem 1.5rem;
    max-width: 680px;
    margin: 0 auto;
    animation: fadeIn 0.8s cubic-bezier(0.16, 1, 0.3, 1);
  }

  .screen.active {
    display: block;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* === ãƒ–ãƒ©ãƒ³ãƒ‰ãƒ˜ãƒƒãƒ€ãƒ¼ === */
  .brand-header {
    text-align: center;
    padding: 3rem 0 2rem;
  }

  .brand-header .logo {
    font-size: 2.5rem;
    font-weight: 800;
    color: #0A0A1F;
    letter-spacing: -0.02em;
    margin-bottom: 0.5rem;
  }

  .brand-header .tagline {
    font-size: 0.85rem;
    color: rgba(10, 10, 31, 0.5);
    text-transform: uppercase;
    letter-spacing: 0.3em;
  }

  /* === ã‚«ãƒ¼ãƒ‰ (Glassmorphism) === */
  .card {
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(10, 10, 31, 0.05);
    border-radius: 20px;
    padding: 2rem;
    margin-bottom: 1.5rem;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.02);
    transition: transform 0.3s ease;
  }

  .card-title {
    font-size: 0.75rem;
    color: rgba(10, 10, 31, 0.4);
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    margin-bottom: 1.5rem;
  }

  /* === ãƒœã‚¿ãƒ³ === */
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 1rem 2rem;
    border: none;
    border-radius: 12px;
    font-size: 1rem;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    font-family: inherit;
  }

  .btn-primary {
    background: #0A0A1F;
    color: #FDFDFF;
  }

  .btn-primary:hover {
    transform: scale(1.02);
    box-shadow: 0 15px 30px rgba(10, 10, 31, 0.2);
  }

  .btn-secondary {
    background: rgba(10, 10, 31, 0.03);
    color: #0A0A1F;
    border: 1px solid rgba(10, 10, 31, 0.08);
  }

  .btn-secondary:hover {
    background: rgba(10, 10, 31, 0.06);
  }

  .btn-full {
    width: 100%;
  }

  /* === å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ === */
  .input-group {
    margin-bottom: 1.5rem;
  }

  .input-group label {
    display: block;
    font-size: 0.85rem;
    color: rgba(10, 10, 31, 0.6);
    margin-bottom: 0.6rem;
    font-weight: 600;
  }

  .input-field {
    width: 100%;
    padding: 1rem 1.25rem;
    background: #F8F9FF;
    border: 1px solid rgba(10, 10, 31, 0.05);
    border-radius: 12px;
    color: #0A0A1F;
    font-size: 1rem;
    transition: all 0.3s ease;
  }

  .input-field:focus {
    outline: none;
    background: #FFFFFF;
    border-color: #0A0A1F;
    box-shadow: 0 0 0 4px rgba(10, 10, 31, 0.03);
  }

  /* === ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ === */
  .nav-bar {
    position: fixed;
    bottom: 2rem;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    border: 1px solid rgba(10, 10, 31, 0.05);
    border-radius: 40px;
    display: flex;
    padding: 0.5rem 1rem;
    gap: 0.5rem;
    box-shadow: 0 20px 50px rgba(0, 0, 0, 0.05);
    z-index: 1000;
  }

  .nav-bar .nav-item {
    padding: 0.5rem 1.25rem;
    border-radius: 30px;
    cursor: pointer;
    color: rgba(10, 10, 31, 0.4);
    font-weight: 700;
    font-size: 0.85rem;
    transition: all 0.3s ease;
    background: none;
    border: none;
    display: flex;
    align-items: center;
    gap: 0.4rem;
  }

  .nav-bar .nav-item.active {
    background: #0A0A1F;
    color: #FDFDFF;
  }

  /* === ãƒˆãƒ¼ã‚¹ãƒˆ (Floating) === */
  .toast {
    position: fixed;
    bottom: 7rem;
    left: 50%;
    transform: translateX(-50%);
    background: #0A0A1F;
    color: #FDFDFF;
    padding: 0.8rem 1.5rem;
    border-radius: 40px;
    font-size: 0.9rem;
    font-weight: 600;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    z-index: 2000;
    animation: toastSlide 0.4s cubic-bezier(0.16, 1, 0.3, 1);
  }

  @keyframes toastSlide {
    from {
      opacity: 0;
      transform: translate(-50%, 20px);
    }

    to {
      opacity: 1;
      transform: translate(-50%, 0);
    }
  }

  /* === ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° (Minimal) === */
  .loading-overlay {
    position: fixed;
    inset: 0;
    background: #FDFDFF;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 3000;
  }

  .spinner {
    width: 30px;
    height: 30px;
    border: 2px solid rgba(10, 10, 31, 0.1);
    border-top-color: #0A0A1F;
    border-radius: 50%;
    animation: spin 0.6s linear infinite;
  }

  /* === ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ– === */
  @media (max-width: 480px) {
    .brand-header .logo {
      font-size: 2rem;
    }

    .nav-bar {
      width: 90%;
      bottom: 1.5rem;
    }

    .nav-bar .nav-item span:not(.nav-icon) {
      display: none;
    }
  }
</style>
</head>

<body>

  <!-- ============ ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° ============ -->
  <div id="loadingOverlay" class="loading-overlay hidden">
    <div class="spinner"></div>
    <div class="loading-text" id="loadingText">èª­ã¿è¾¼ã¿ä¸­...</div>
  </div>

  <!-- === Coming Soon ç”»é¢ === -->
  <div id="screenComingSoon" class="screen">
    <div class="brand-header">
      <div class="logo">CC Lume</div>
      <div class="tagline">MODERN COMMAND CENTER</div>
    </div>

    <div class="card text-center">
      <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸš€</div>
      <h2 style="margin-bottom: 1rem;">Coming Soon...</h2>
      <p style="color: #7A7592; font-size: 0.9rem; margin-bottom: 2rem;">
        ã”ç™»éŒ²ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚<br>
        æŠ•ç¨¿ä½œæˆæ©Ÿèƒ½ã‚’å«ã‚€ãƒ•ãƒ«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ç¾åœ¨é–‹ç™ºä¸­ã§ã™ã€‚<br>
        æº–å‚™ãŒæ•´ã„æ¬¡ç¬¬ã€é †æ¬¡å…¬é–‹ã•ã›ã¦ã„ãŸã ãã¾ã™ã€‚
      </p>
      <button class="btn btn-secondary btn-full" onclick="handleLogout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¦é–‰ã˜ã‚‹</button>
    </div>
  </div>

  <!-- === Dashboard ç”»é¢ === -->
  <div id="toast" class="toast hidden"></div>

  <!-- ============================================================
     Screen 1: Access Gateï¼ˆãƒ­ã‚°ã‚¤ãƒ³ï¼‰
     ============================================================ -->
  <div id="screenLogin" class="screen active">
    <div class="brand-header">
      <div class="logo">CC Lume</div>
      <div class="tagline">Your Post Engine</div>
    </div>

    <div class="card card-glow mt-3">
      <div class="card-title">Access Gate</div>

      <div class="input-group">
        <label>ç™ºè¡Œã‚­ãƒ¼ã‚³ãƒ¼ãƒ‰</label>
        <input type="text" id="loginShareKey" class="input-field" placeholder="å…±æœ‰æ™‚ã«ç™ºè¡Œã•ã‚ŒãŸã‚­ãƒ¼">
      </div>
      <div class="input-group">
        <label>Gmailã‚¢ãƒ‰ãƒ¬ã‚¹</label>
        <input type="email" id="loginGmail" class="input-field" placeholder="example@gmail.com">
      </div>
      <div class="input-group">
        <label>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
        <input type="password" id="loginPassword" class="input-field" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰">
      </div>

      <button class="btn btn-primary btn-full mt-2" id="btnLogin" onclick="handleLogin()">
        ãƒ­ã‚°ã‚¤ãƒ³
      </button>
    </div>
  </div>

  <!-- ============================================================
     Screen 2: Starter Kitï¼ˆåˆå›ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆï¼‰
     ============================================================ -->
  <div id="screenPresent" class="screen">
    <div class="present-screen">
      <div class="brand-header">
        <div class="logo">Welcome!</div>
        <div class="tagline">Starter Kit</div>
      </div>

      <div id="presentProfileArea" class="profile-card">
        <div id="presentBannerWrap" class="banner-box hidden">
          <img id="presentBannerImage" src="" alt="Banner">
        </div>

        <div class="profile-main">
          <div id="presentIconWrap" class="icon-box hidden">
            <img id="presentIconImage" src="" alt="Icon">
          </div>
          <div class="profile-info">
            <div id="presentAccountName" class="p-name" title="ã‚¿ãƒƒãƒ—ã§ã‚³ãƒ”ãƒ¼"></div>
            <div id="presentId" class="p-id" title="ã‚¿ãƒƒãƒ—ã§ã‚³ãƒ”ãƒ¼"></div>
          </div>
        </div>

        <div class="profile-bio-box">
          <div id="presentBio" class="p-bio"></div>
        </div>

        <div class="profile-meta">
          <div class="input-group">
            <label>æ‹›å¾…ã‚³ãƒ¼ãƒ‰ (ã‚¿ãƒƒãƒ—ã§ã‚³ãƒ”ãƒ¼)</label>
            <div id="presentInviteCode" class="p-invite"></div>
          </div>
        </div>
      </div>

      <div class="copy-guide">
        ğŸ’¡ å„é …ç›®ã‚’ã‚¿ãƒƒãƒ—ã—ã¦å†…å®¹ã‚’ã‚³ãƒ”ãƒ¼ã§ãã¾ã™
      </div>

      <button class="btn btn-primary btn-full mt-3" onclick="handleCompleteFirstLogin()">
        å—ã‘å–ã£ã¦ã¯ã˜ã‚ã‚‹
      </button>
    </div>
  </div>

  <!-- ============================================================
     Screen 3: Command Deckï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼‰
     ============================================================ -->
  <div id="screenDashboard" class="screen">
    <div class="brand-header">
      <div class="logo">CC Lume</div>
      <div class="tagline" id="dashUserName"></div>
    </div>

    <!-- æˆ¦ç•¥ãƒãƒŠãƒ¼ -->
    <div class="strategy-banner" id="dashStrategyBanner"></div>

    <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
    <div class="stat-row">
      <div class="stat-box">
        <div class="stat-value" id="dashTodayCount">0</div>
        <div class="stat-label">ä»Šæ—¥ã®ç”Ÿæˆ</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="dashDailyMax">3</div>
        <div class="stat-label">æœ¬æ—¥ä¸Šé™</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="dashTotalCount">0</div>
        <div class="stat-label">ç´¯è¨ˆç”Ÿæˆ</div>
      </div>
    </div>

    <!-- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
    <button class="btn btn-primary btn-full" onclick="navigateTo('studio')">
      âœï¸ æŠ•ç¨¿ã‚’ã¤ãã‚‹
    </button>
    <button class="btn btn-secondary btn-full mt-1" onclick="navigateTo('dictionary')">
      ğŸ“– è¾æ›¸ã‚’è‚²ã¦ã‚‹
    </button>
  </div>

  <!-- ============================================================
     Screen 4: Post Studioï¼ˆæŠ•ç¨¿ç”Ÿæˆ - 1ç”»é¢æ®µéšè¡¨ç¤ºï¼‰
     ============================================================ -->
  <div id="screenStudio" class="screen">
    <!-- æˆ¦ç•¥ãƒãƒŠãƒ¼ -->
    <div class="strategy-banner" id="studioStrategyBanner"></div>

    <!-- â‘  ãƒ†ãƒ¼ãƒ / ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå…¥åŠ› -->
    <div class="card">
      <div class="card-title">â‘  ãƒ†ãƒ¼ãƒ / ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ</div>
      <div class="input-group">
        <label>ãƒ†ãƒ¼ãƒ</label>
        <input type="text" id="inputTheme" class="input-field" placeholder="ä¾‹ï¼šå‰¯æ¥­å¯©æŸ»ã«è½ã¡ãŸä½“é¨“" maxlength="100">
        <div class="char-counter"><span id="themeCount">0</span>/100</div>
      </div>
      <div class="input-group">
        <label>ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ</label>
        <input type="text" id="inputTarget" class="input-field" placeholder="ä¾‹ï¼šå‰¯æ¥­åˆå¿ƒè€…ãƒ»ä¸å®‰å±¤" maxlength="50">
        <div class="char-counter"><span id="targetCount">0</span>/50</div>
      </div>

      <button class="btn btn-primary btn-full mt-1" id="btnGenerate" onclick="handleGenerate()">
        ğŸš€ ç”Ÿæˆã™ã‚‹
      </button>
      <div class="text-center mt-1">
        <span style="font-size:0.8rem;color:#7A7592;">æ®‹ã‚Š <span id="studioRemaining">3</span> å›</span>
      </div>
    </div>

    <!-- â‘¡ æŠ•ç¨¿ãƒ†ãƒ³ãƒ—ãƒ¬ï¼ˆç©´åŸ‹ã‚ï¼‰- ç”Ÿæˆå¾Œã«è¡¨ç¤º -->
    <div id="templateSection" class="hidden mt-2">
      <div class="card">
        <div class="card-title">â‘¡ ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆç©´åŸ‹ã‚ï¼‰</div>
        <div id="templateSlots"></div>
      </div>
    </div>

    <!-- â‘¢â‘£ ç”Ÿæˆçµæœ / ãƒ¡ã‚¤ãƒ³æŠ•ç¨¿ / ãƒªãƒ—ãƒ©ã‚¤ -->
    <div id="resultSection" class="hidden mt-2">
      <!-- A/BæŠ•ç¨¿ã‚«ãƒ¼ãƒ‰ -->
      <div id="postCards"></div>

      <!-- â‘¢ ãƒ¡ã‚¤ãƒ³æŠ•ç¨¿ç·¨é›† -->
      <div class="card mt-2">
        <div class="card-title">â‘¢ ãƒ¡ã‚¤ãƒ³æŠ•ç¨¿ï¼ˆç·¨é›†å¯èƒ½ï¼‰</div>
        <textarea id="mainPostEdit" class="input-field" rows="4" placeholder="ãƒ†ãƒ³ãƒ—ãƒ¬ã‹ã‚‰åæ˜ ã™ã‚‹ã‹ã€ç›´æ¥ç·¨é›†ã—ã¦ãã ã•ã„"></textarea>
        <div class="char-counter" id="mainPostCounter">0/140</div>
        <button class="btn btn-sm btn-secondary mt-1" onclick="reflectTemplateToMain()">ãƒ†ãƒ³ãƒ—ãƒ¬ã‹ã‚‰æœ¬æ–‡ã«åæ˜ </button>
      </div>

      <!-- â‘£ ãƒªãƒ—ãƒ©ã‚¤ç·¨é›† -->
      <div class="card">
        <div class="card-title">â‘£ ãƒªãƒ—ãƒ©ã‚¤</div>
        <div id="replyBlocks"></div>
        <button class="btn btn-sm btn-secondary mt-1" onclick="addReplyBlock()">ï¼‹ ãƒªãƒ—ã‚’è¿½åŠ </button>
      </div>

      <!-- â‘¤ æˆ¦ç•¥ã‚¬ã‚¤ãƒ‰ -->
      <div id="strategyGuidePanel" class="guide-panel mt-2"></div>

      <!-- â‘¥ ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ -->
      <div class="card mt-2">
        <div class="card-title">â‘¥ ã‚³ãƒ”ãƒ¼ â†’ Xã«è²¼ã‚‹ã ã‘</div>
        <button class="btn btn-copy btn-full mb-1" onclick="copyMainPost()">ğŸ“‹ ãƒ¡ã‚¤ãƒ³æŠ•ç¨¿ã‚’ã‚³ãƒ”ãƒ¼</button>
        <button class="btn btn-copy btn-full mb-1" onclick="copyReply(0)">ğŸ“‹ ãƒªãƒ—1ã‚’ã‚³ãƒ”ãƒ¼</button>
        <button class="btn btn-copy btn-full" onclick="copyAllReplies()">ğŸ“‹ ãƒªãƒ—å…¨éƒ¨ã‚’é †ç•ªã‚³ãƒ”ãƒ¼</button>
      </div>

      <!-- æ›¸ãæ–¹ã‚¬ã‚¤ãƒ‰ï¼ˆå›ºå®šï¼‰ -->
      <div class="writing-guide">
        <h5>ğŸ“ æ›¸ãæ–¹ã‚¬ã‚¤ãƒ‰ï¼ˆ30ç§’ï¼‰</h5>
        <div class="guide-do">âœ… ã€ ã€‘ã‚’ã‚ãªãŸã®ä½“é¨“ã«ç½®ãæ›ãˆã¦ãã ã•ã„</div>
        <div class="guide-do">âœ… æ•°å­— or å›ºæœ‰åè©ã‚’1ã¤å…¥ã‚Œã‚‹ã¨å¼·ããªã‚Šã¾ã™</div>
        <div class="guide-do">âœ… å®Œç’§ã«æ›¸ã“ã†ã¨ã—ãªãã¦OK</div>
        <div class="guide-dont mt-1">ğŸš« ã€ã€‘ã‚’æ¶ˆã•ãšã«æŠ•ç¨¿</div>
        <div class="guide-dont">ğŸš« å…¨éƒ¨ä¸€èˆ¬è«–ã«ã™ã‚‹</div>
        <div class="guide-dont">ğŸš« CTAã‚’ç„¡ç†ã«ã¤ã‘ã‚‹</div>
      </div>
    </div>
  </div>

  <!-- ============================================================
     Screen 5: Experience Dictionaryï¼ˆè¾æ›¸ï¼‰
     ============================================================ -->
  <div id="screenDictionary" class="screen">
    <div class="brand-header">
      <div class="logo" style="font-size:1.5rem;">Experience Dictionary</div>
      <div class="tagline">ã‚ãªãŸã®å¼•ãå‡ºã—</div>
    </div>

    <div class="card">
      <div class="dict-category">
        <label>ğŸ“Œ Factsï¼ˆäº‹å®Ÿã‚·ãƒ¼ãƒ³ï¼‰</label>
        <div class="dict-hint">1ä»¶120ã€œ160æ–‡å­—ï½œä½•ãŒã‚ã£ãŸã‹ã€å…·ä½“çš„ã«</div>
        <textarea id="dictFacts" class="input-field" rows="3" placeholder="ä¾‹ï¼šCrowdWorksã®å¯©æŸ»ã«3å›è½ã¡ãŸã€‚åŸå› ã¯ã€œ"></textarea>
      </div>
      <div class="dict-category">
        <label>ğŸ”¢ Numbersï¼ˆæ•°å­—ï¼‰</label>
        <div class="dict-hint">1ä»¶40æ–‡å­—ä»¥å†…ï½œå…·ä½“çš„ãªæ•°å­—</div>
        <textarea id="dictNumbers" class="input-field" rows="2" placeholder="ä¾‹ï¼š3ãƒ¶æœˆã§æœˆ10ä¸‡é”æˆ"></textarea>
      </div>
      <div class="dict-category">
        <label>ğŸ’ª Effortsï¼ˆåŠªåŠ›ï¼‰</label>
        <div class="dict-hint">1ä»¶80ã€œ120æ–‡å­—ï½œä½•ã‚’é ‘å¼µã£ãŸã‹</div>
        <textarea id="dictEfforts" class="input-field" rows="3" placeholder="ä¾‹ï¼šæ¯æœ5æ™‚ã«èµ·ãã¦1æ™‚é–“ã ã‘ä½œæ¥­ã—ãŸ"></textarea>
      </div>
      <div class="dict-category">
        <label>â¤ï¸ Emotionsï¼ˆæ„Ÿæƒ…ï¼‰</label>
        <div class="dict-hint">1ä»¶40ã€œ80æ–‡å­—ï½œãã®æ™‚ã®æ°—æŒã¡</div>
        <textarea id="dictEmotions" class="input-field" rows="2" placeholder="ä¾‹ï¼šæ‚”ã—ãã¦çœ ã‚Œãªã‹ã£ãŸ"></textarea>
      </div>
      <div class="dict-category">
        <label>âœ¨ Aestheticsï¼ˆç¾å­¦ï¼‰</label>
        <div class="dict-hint">1ä»¶80ã€œ120æ–‡å­—ï½œå¤§åˆ‡ã«ã—ã¦ã„ã‚‹ã“ã¨</div>
        <textarea id="dictAesthetics" class="input-field" rows="3" placeholder="ä¾‹ï¼šé‡ã‚ˆã‚Šè³ªã€‚1æ—¥1æŠ•ç¨¿ã§ã‚‚æœ¬æ°—ã§"></textarea>
      </div>
      <div class="dict-category">
        <label>ğŸ¯ Punchlineï¼ˆè¨€ã„åˆ‡ã‚Šï¼‰</label>
        <div class="dict-hint">1ä»¶60ã€œ90æ–‡å­—ï½œã‚ãªãŸã®æ±ºã‚å°è©</div>
        <textarea id="dictPunchline" class="input-field" rows="2" placeholder="ä¾‹ï¼šçµå±€ã€ã‚„ã£ãŸäººã ã‘ãŒèªã‚Œã‚‹"></textarea>
      </div>

      <button class="btn btn-success btn-full mt-2" onclick="handleSaveDictionary()">
        ğŸ’¾ è¾æ›¸ã‚’ä¿å­˜
      </button>

      <div class="dict-approval">
        ã“ã‚Œã¯ã‚ãªãŸã®è¾æ›¸ã€‚è‚²ã¦ã¦OKã€‚<br>
        å¾Œã‹ã‚‰é•ã†ã¨æ€ã£ãŸã‚‰ã€ç›´ã›ã°ã„ã„ã€‚
      </div>
    </div>

  </div>

  <!-- ============================================================
     Screen 6: Growth Consoleï¼ˆç”Ÿæˆå±¥æ­´/KPIï¼‰
     ============================================================ -->
  <div id="screenGrowth" class="screen">
    <div class="brand-header">
      <div class="logo" style="font-size:1.5rem;">Growth Console</div>
      <div class="tagline">ã‚ãªãŸã®æˆé•·è¨˜éŒ²</div>
    </div>

    <div class="stat-row">
      <div class="stat-box">
        <div class="stat-value" id="growthTotal">0</div>
        <div class="stat-label">ç´¯è¨ˆç”Ÿæˆæ•°</div>
      </div>
      <div class="stat-box">
        <div class="stat-value" id="growthToday">0</div>
        <div class="stat-label">ä»Šæ—¥ã®ç”Ÿæˆ</div>
      </div>
    </div>

    <div class="card">
      <div class="card-title">æˆ¦ç•¥å®Ÿç¸¾</div>
      <div style="font-size:0.85rem;color:#9B95B0;">
        ä»Šå¾Œã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã§ã€æˆ¦ç•¥ã”ã¨ã®å®Ÿç¸¾ã‚„åå¿œç‡ã‚’è¡¨ç¤ºäºˆå®šã§ã™ã€‚
      </div>
    </div>
  </div>

  <!-- ============================================================
     ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼
     ============================================================ -->
  <nav id="navBar" class="nav-bar hidden">
    <button class="nav-item active" data-screen="dashboard" onclick="navigateTo('dashboard')">
      <span class="nav-icon">ğŸ </span>
      <span>ãƒ›ãƒ¼ãƒ </span>
    </button>
    <button class="nav-item" data-screen="studio" onclick="navigateTo('studio')">
      <span class="nav-icon">âœï¸</span>
      <span>æŠ•ç¨¿</span>
    </button>
    <button class="nav-item" data-screen="dictionary" onclick="navigateTo('dictionary')">
      <span class="nav-icon">ğŸ“–</span>
      <span>è¾æ›¸</span>
    </button>
    <button class="nav-item" data-screen="growth" onclick="navigateTo('growth')">
      <span class="nav-icon">ğŸ“Š</span>
      <span>æˆé•·</span>
    </button>
  </nav>

  <script>
/* ============================================================
     CC Lume â€” Ui_App.js
     ãƒ•ãƒ­ãƒ³ãƒˆJSï¼ˆå…¨ç”»é¢åˆ¶å¾¡ãƒ»APIé€šä¿¡ãƒ»ç©´åŸ‹ã‚ãƒ»ãƒªãƒ—ãƒ©ã‚¤ãƒ»ã‚³ãƒ”ãƒ¼ãƒ»ãƒ’ãƒ³ãƒˆï¼‰
     ============================================================ */

  // === ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ ===
  var APP = {
    token: null,
    lotNumber: null,
    currentScreen: 'login',
    strategy: null,
    strategyColor: null,
    posts: null,
    replyCount: 0,
    templateData: null,
    shareKey: '', // è¿½åŠ 
    // Vercelãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã®GASãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰URL
    gasUrl: 'https://script.google.com/macros/s/AKfycbyARAuxDvgIRAH3-K9peyYTO0kdMuccij2Udkld46plyrOAeFqpFv00MfBF6GsAwnq6/exec'
  };

  /**
   * APIå‘¼ã³å‡ºã—ã®çµ±åˆãƒ©ãƒƒãƒ‘ãƒ¼
   * GASç’°å¢ƒãªã‚‰ google.script.runã€Vercelç­‰ãªã‚‰ fetch (/api/proxy) ã‚’ä½¿ç”¨
   */
  async function callApi(action, payload) {
    return new Promise((resolve, reject) => {
      // GASç’°å¢ƒåˆ¤å®š
      if (typeof google !== 'undefined' && google.script && google.script.run) {
        google.script.run
          .withSuccessHandler(resolve)
          .withFailureHandler(reject)
        [action].apply(google.script.run, payload);
      } else {
        // Vercelç’°å¢ƒ: è‡ªå‰ã®APIãƒ—ãƒ­ã‚­ã‚·ã‚’çµŒç”±ã—ã¦GASã‚’å©ã
        console.log('--- callApi (fetch) START ---', action);
        fetch('/api/proxy', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ action: action, payload: payload })
        })
          .then(res => {
            console.log('--- callApi (fetch) Status ---', res.status);
            return res.json();
          })
          .then(data => {
            console.log('--- callApi (fetch) SUCCESS ---', action, data.success);
            resolve(data);
          })
          .catch(err => {
            console.error('--- callApi (fetch) ERROR ---', action, err);
            reject(err);
          });
      }
    });
  }

  // ============================================================
  // ç”»é¢é·ç§»
  // ============================================================
  function navigateTo(screen) {
    // === Version 1.0 å¯¸æ–­ã‚¬ãƒ¼ãƒ‰ ===
    // ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã‹ã¤Coming SoonãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¹ãçŠ¶æ…‹ãªã‚‰ã€ä»–ç”»é¢ã¸ã®é·ç§»ã‚’é˜»æ­¢
    if (APP.token && screen !== 'login' && screen !== 'present' && screen !== 'comingSoon') {
      screen = 'comingSoon';
    }

    // å…¨ç”»é¢éè¡¨ç¤º
    document.querySelectorAll('.screen').forEach(function (s) { s.classList.remove('active'); });

    var screenMap = {
      'login': 'screenLogin',
      'present': 'screenPresent',
      'comingSoon': 'screenComingSoon',
      'dashboard': 'screenDashboard',
      'studio': 'screenStudio',
      'dictionary': 'screenDictionary',
      'growth': 'screenGrowth'
    };

    var el = document.getElementById(screenMap[screen]);
    if (el) el.classList.add('active');
    APP.currentScreen = screen;

    // ãƒŠãƒ“ãƒãƒ¼è¡¨ç¤ºåˆ¶å¾¡
    var nav = document.getElementById('navBar');
    if (screen === 'login' || screen === 'present' || screen === 'comingSoon') {
      nav.classList.add('hidden'); // Coming Soonã§ã‚‚éš ã™
    } else {
      nav.classList.remove('hidden');
    }

    // ãƒŠãƒ“ã‚¢ã‚¯ãƒ†ã‚£ãƒ–
    document.querySelectorAll('.nav-item').forEach(function (ni) {
      ni.classList.toggle('active', ni.dataset.screen === screen);
    });

    // ç”»é¢ã”ã¨ã®åˆæœŸåŒ–
    if (screen === 'dashboard') loadDashboard();
    if (screen === 'studio') loadStudio();
    if (screen === 'dictionary') loadDictionary();
    if (screen === 'growth') loadGrowth();
    if (screen === 'present') loadPresent();

    window.scrollTo(0, 0);
  }

  // ============================================================
  // ãƒ­ã‚°ã‚¤ãƒ³
  // ============================================================
  function handleLogin() {
    var shareKey = document.getElementById('loginShareKey').value.trim();
    var gmail = document.getElementById('loginGmail').value.trim();
    var password = document.getElementById('loginPassword').value.trim();

    if (!shareKey || !gmail || !password) {
      showToast('å…¨ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', 'error');
      return;
    }

    showLoading('ãƒ­ã‚°ã‚¤ãƒ³ä¸­...');
    document.getElementById('btnLogin').disabled = true;

    callApi('apiLogin', { shareKey: shareKey, gmail: gmail, password: password })
      .then(function (res) {
        hideLoading();
        document.getElementById('btnLogin').disabled = false;
        if (res.success) {
          APP.token = res.token;
          APP.shareKey = shareKey; // ç™ºè¡Œã‚­ãƒ¼ã‚’ä¿æŒ
          if (res.isFirstLogin) {
            setupPresent(res.accountInfo);
            navigateTo('present');
          } else {
            navigateTo('comingSoon'); // ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ãªã‚‰ç›´æ¥Coming Soonã¸
          }
        } else {
          showToast(res.error || 'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
        }
      })
      .catch(function (err) {
        hideLoading();
        document.getElementById('btnLogin').disabled = false;
        showToast('é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚', 'error');
      });
  }

  // ============================================================
  // åˆå›ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ
  // ============================================================
  function setupPresent(accountInfo) {
    // å­˜åœ¨ã—ãªã„è¦ç´ (presentName)ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’å‰Šé™¤ã—ã¦ã‚¯ãƒ©ãƒƒã‚·ãƒ¥é˜²æ­¢
    document.getElementById('presentBannerWrap').classList.add('hidden');
    document.getElementById('presentIconWrap').classList.add('hidden');
    document.getElementById('presentAccountName').textContent = accountInfo.accountName || '';
    document.getElementById('presentId').textContent = '';
    document.getElementById('presentBio').textContent = '';
    document.getElementById('presentInviteCode').textContent = '';
  }

  function loadPresent() {
    if (!APP.shareKey) {
      console.error('shareKey ãŒæœªè¨­å®šã®ãŸã‚ Starter Kit ã‚’å–å¾—ã§ãã¾ã›ã‚“');
      return;
    }

    callApi('apiGetStartupItems', { shareKey: APP.shareKey })
      .then(function (res) {
        console.log('StartupItems res:', res);
        if (!res || !res.success) {
          console.error('apiGetStartupItems ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ');
          return;
        }

        var bannerUrl = res.bannerUrl || '';
        var iconUrl = res.iconUrl || '';
        var x = (res.xId || '').trim();
        if (x && x[0] !== '@') x = '@' + x;

        document.getElementById('presentAccountName').textContent = res.accountName || '';
        document.getElementById('presentId').textContent = x;
        document.getElementById('presentBio').textContent = res.bio || '';
        document.getElementById('presentInviteCode').textContent = res.inviteCode || '';

        if (bannerUrl) {
          document.getElementById('presentBannerImage').src = bannerUrl;
          document.getElementById('presentBannerWrap').classList.remove('hidden');
        }
        if (iconUrl) {
          document.getElementById('presentIconImage').src = iconUrl;
          document.getElementById('presentIconWrap').classList.remove('hidden');
        }

        // å„è¦ç´ ã‚’ã‚¯ãƒªãƒƒã‚¯ã§ã‚³ãƒ”ãƒ¼ï¼ˆæŒ‡ç¤ºã«åŸºã¥ãã€Œåå¿œã€ã®æ”¹å–„ï¼‰
        var setCopyClick = function (id, text, label) {
          var el = document.getElementById(id);
          if (!el) return;
          el.style.cursor = 'pointer';
          el.title = label + 'ã‚’ã‚³ãƒ”ãƒ¼';
          el.onclick = function () {
            if (!text) return;
            copyToClipboard(text);
          };
        };

        setCopyClick('presentAccountName', res.accountName, 'ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå');
        setCopyClick('presentId', x, 'ID');
        setCopyClick('presentBio', res.bio, 'ãƒã‚¤ã‚ª');
        setCopyClick('presentInviteCode', res.inviteCode, 'æ‹›å¾…ã‚³ãƒ¼ãƒ‰');
        setCopyClick('presentBannerWrap', bannerUrl, 'ãƒãƒŠãƒ¼URL');
        setCopyClick('presentIconWrap', iconUrl, 'ã‚¢ã‚¤ã‚³ãƒ³URL');

      })
      .catch(function (err) {
        console.error('apiGetStartupItems error:', err);
      });
  }

  function handleCompleteFirstLogin() {
    showLoading('æº–å‚™ä¸­...');
    callApi('apiCompleteFirstLogin', { token: APP.token })
      .then(function (res) {
        hideLoading();
        navigateTo('comingSoon'); // Coming Soonã¸é·ç§»
      })
      .catch(function () {
        hideLoading();
        navigateTo('comingSoon');
      });
  }

  // ============================================================
  // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
  // ============================================================
  function loadDashboard() {
    if (!APP.token) return;
    callApi('apiGetDashboard', { token: APP.token })
      .then(function (res) {
        if (!res.success) return;
        document.getElementById('dashUserName').textContent = (res.accountName || res.userName || '') + ' â€” Command Deck';
        document.getElementById('dashTodayCount').textContent = res.todayCount;
        document.getElementById('dashDailyMax').textContent = res.dailyMax;
        document.getElementById('dashTotalCount').textContent = res.totalCount;

        var banner = document.getElementById('dashStrategyBanner');
        banner.textContent = 'ä»Šæ—¥ã¯' + res.dayName + 'æ›œæ—¥ã€‚' + res.strategy + ' ã§ä¼¸ã°ã™æ—¥ã§ã™ã€‚';
        banner.className = 'strategy-banner ' + res.strategy;

        APP.strategy = res.strategy;
        APP.strategyColor = res.strategyColor;
      })
      .catch(function (err) {
        console.error('dashboard error:', err);
      });
  }

  // ============================================================
  // æŠ•ç¨¿ç”Ÿæˆç”»é¢
  // ============================================================
  function loadStudio() {
    if (!APP.token) return;
    callApi('apiGetStrategyGuide', { token: APP.token })
      .then(function (res) {
        if (!res.success) return;
        var banner = document.getElementById('studioStrategyBanner');
        banner.textContent = 'ä»Šæ—¥ã¯' + res.dayName + 'æ›œæ—¥ã€‚' + res.strategy + ' ã§ä¼¸ã°ã™æ—¥ã§ã™ã€‚';
        banner.className = 'strategy-banner ' + res.strategy;
        APP.strategy = res.strategy;

        // æˆ¦ç•¥ã‚¬ã‚¤ãƒ‰è¡¨ç¤º
        renderStrategyGuide(res.guide);

        // æ®‹ã‚Šå›æ•°å–å¾— (DashboardçµŒç”±)
        return callApi('apiGetDashboard', { token: APP.token });
      })
      .then(function (dashRes) {
        if (dashRes && dashRes.success) {
          var remaining = dashRes.dailyMax - dashRes.todayCount;
          document.getElementById('studioRemaining').textContent = Math.max(0, remaining);
        }
      })
      .catch(function (err) {
        console.error('studio init error:', err);
      });

    // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
    document.getElementById('inputTheme').oninput = function () {
      document.getElementById('themeCount').textContent = this.value.length;
    };
    document.getElementById('inputTarget').oninput = function () {
      document.getElementById('targetCount').textContent = this.value.length;
    };
  }

  function handleGenerate() {
    var theme = document.getElementById('inputTheme').value.trim();
    var target = document.getElementById('inputTarget').value.trim();

    if (!theme) { showToast('ãƒ†ãƒ¼ãƒã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', 'error'); return; }
    if (!target) { showToast('ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚', 'error'); return; }

    showLoading('AIç”Ÿæˆä¸­...');
    document.getElementById('btnGenerate').disabled = true;

    callApi('apiGeneratePosts', { token: APP.token, theme: theme, target: target, params: null })
      .then(function (res) {
        hideLoading();
        document.getElementById('btnGenerate').disabled = false;
        if (res.success) {
          APP.posts = res.posts;
          APP.templateData = res.templateInfo;
          renderGenerationResult(res);
          showToast('ç”Ÿæˆå®Œäº†ï¼', 'success');
        } else {
          showToast(res.message, 'error');
        }
      })
      .catch(function (err) {
        hideLoading();
        document.getElementById('btnGenerate').disabled = false;
        showToast('ç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚', 'error');
      });
  }

  function renderGenerationResult(res) {
    // æ®‹ã‚Šå›æ•°æ›´æ–°
    var remaining = res.dailyMax - res.todayCount;
    document.getElementById('studioRemaining').textContent = Math.max(0, remaining);

    // ãƒ†ãƒ³ãƒ—ãƒ¬ç©´åŸ‹ã‚
    renderTemplateSlots(res.strategy, res.templateInfo);
    document.getElementById('templateSection').classList.remove('hidden');

    // A/BæŠ•ç¨¿ã‚«ãƒ¼ãƒ‰
    var cardsHtml = '';
    for (var i = 0; i < res.posts.length; i++) {
      var p = res.posts[i];
      var cl = p.checklistResult;
      cardsHtml += '<div class="post-card">';
      cardsHtml += '<span class="variant-badge ' + p.abVariant + '">' + p.abVariant + ' â€” ' + (res.abRules ? res.abRules[p.abVariant] : '') + '</span>';
      cardsHtml += '<div class="post-text">' + escapeHtml(p.text) + '</div>';
      cardsHtml += '<div class="char-count' + (p.text.length > 140 ? ' over' : '') + '">' + p.text.length + 'æ–‡å­—</div>';
      if (!cl.passed) {
        cardsHtml += '<div class="checklist-warn">';
        for (var r = 0; r < cl.reasons.length; r++) {
          cardsHtml += 'âš ï¸ ' + escapeHtml(cl.reasons[r]) + '<br>';
        }
        cardsHtml += '</div>';
      }
      cardsHtml += '<button class="btn btn-copy btn-sm mt-1" onclick="copyPostText(' + i + ')">ğŸ“‹ ã‚³ãƒ”ãƒ¼</button>';
      cardsHtml += '</div>';
    }
    document.getElementById('postCards').innerHTML = cardsHtml;

    // ãƒ¡ã‚¤ãƒ³æŠ•ç¨¿ç·¨é›†æ¬„ã«AæŠ•ç¨¿ã‚’ã‚»ãƒƒãƒˆ
    document.getElementById('mainPostEdit').value = res.posts[0] ? res.posts[0].text : '';
    updateMainPostCounter();

    // ãƒ¡ã‚¤ãƒ³æŠ•ç¨¿ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼
    document.getElementById('mainPostEdit').oninput = updateMainPostCounter;

    // ãƒªãƒ—ãƒ©ã‚¤åˆæœŸåŒ–
    document.getElementById('replyBlocks').innerHTML = '';
    APP.replyCount = 0;
    // EMPATHY/PROOFã¯åˆæ‰‹ãƒªãƒ—è‡ªå‹•æŒ¿å…¥
    if (res.strategy === 'EMPATHY' || res.strategy === 'PROOF') {
      addReplyBlock('ãƒªãƒ—ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼å®Ÿã¯ã“ã®è©±ã«ã¯ç¶šããŒã‚ã£ã¦â€¦');
    } else {
      addReplyBlock('');
    }

    document.getElementById('resultSection').classList.remove('hidden');
  }

  function updateMainPostCounter() {
    var text = document.getElementById('mainPostEdit').value;
    var counter = document.getElementById('mainPostCounter');
    counter.textContent = text.length + '/140';
    counter.className = 'char-counter';
    if (text.length > 140) counter.className += ' over';
    else if (text.length > 130) counter.className += ' warn';
  }

  // ============================================================
  // ãƒ†ãƒ³ãƒ—ãƒ¬ç©´åŸ‹ã‚
  // ============================================================
  function renderTemplateSlots(strategy, templateInfo) {
    var templates = {
      PARADOX: [
        { label: 'å¸¸è­˜', placeholder: 'ã¿ã‚“ãªãŒä¿¡ã˜ã¦ã„ã‚‹å‰æ', hints: ['è‡ªåˆ†ã‚‚æ˜”ã¯ä¿¡ã˜ã¦ã„ãŸã“ã¨', 'SNSã§ã‚ˆãè¦‹ã‚‹è¨€è‘‰', '"æ™®é€šã¯ã“ã†"ã¨æ€ã‚ã‚Œã¦ã„ã‚‹ã“ã¨'] },
        { label: 'ä½“é¨“', placeholder: 'ä¸€ç•ªã—ã‚“ã©ã‹ã£ãŸå…·ä½“å ´é¢', hints: ['å¤±æ•—ã—ãŸæ•°å­—ãƒ»æœŸé–“', 'æ„Ÿæƒ…ãŒå‹•ã„ãŸç¬é–“', 'èª°ã«ã‚‚è¨€ã£ã¦ãªã„ä½“é¨“'] },
        { label: 'å•ã„', placeholder: 'è»½ã„å•ã„ã‹ã‘', hints: ['ã€Œã‚ãªãŸã¯ã©ã†æ€ã†ï¼Ÿã€', 'ã€Œæœ¬å½“ã«ãã†ï¼Ÿã€', 'è€ƒãˆã•ã›ã‚‹ä¸€è¨€'] }
      ],
      EMPATHY: [
        { label: 'æ‚©ã¿', placeholder: 'ä»Šã¤ã‚‰ã„çŠ¶æ³', hints: ['æˆ‘æ…¢ã—ã¦ã„ãŸã“ã¨ã¯ï¼Ÿ', 'è¨€ãˆãªã‹ã£ãŸæœ¬éŸ³ã¯ï¼Ÿ', 'é€ƒã’ãŸã‹ã£ãŸç¬é–“ã¯ï¼Ÿ'] },
        { label: 'éå»ä½“é¨“', placeholder: 'è‡ªåˆ†ã‚‚åŒã˜ã ã£ãŸè©±', hints: ['ã„ã¤ã€ã©ã“ã§ï¼Ÿ', 'ä½•ãŒä¸€ç•ªãã¤ã‹ã£ãŸï¼Ÿ', 'ä»Šãªã‚‰å½“æ™‚ã®è‡ªåˆ†ã«ä½•ã¨è¨€ã†ï¼Ÿ'] },
        { label: 'å‘¼ã³ã‹ã‘', placeholder: 'å…±æœ‰ãƒ»èª˜ã„', hints: ['ã€Œä½“é¨“æ•™ãˆã¦ã€', 'ã€ŒåŒã˜äººã„ãªã„ï¼Ÿã€', 'è¿”ä¿¡ã—ã‚„ã™ã„å•ã„ã‹ã‘'] }
      ],
      PROOF: [
        { label: 'æ•°å­—æˆæœ', placeholder: 'å…·ä½“çš„ãªæ•°å­—çµæœ', hints: ['æœŸé–“ã¨é‡‘é¡', 'Beforeâ†’After', 'æ•°å­—ã§è¨€ã†ã¨ä½•ãŒå¤‰ã‚ã£ãŸï¼Ÿ'] },
        { label: 'è¡Œå‹•â‘ ', placeholder: 'å…·ä½“è¡Œå‹•1ã¤ç›®', hints: ['ä¸€ç•ªåŠ¹æœãŒã‚ã£ãŸã“ã¨', 'æ¯æ—¥ã‚„ã£ãŸã“ã¨', '1ã¤ã«çµã‚‹ãªã‚‰ï¼Ÿ'] },
        { label: 'è¡Œå‹•â‘¡', placeholder: 'å…·ä½“è¡Œå‹•2ã¤ç›®', hints: ['è£œåŠ©çš„ã«ã‚„ã£ãŸã“ã¨', 'é€†ã«ã€Œã‚„ã‚‰ãªãã¦ã„ã„ã€ã¨æ€ã£ãŸã“ã¨', 'ã‚³ã‚¹ãƒˆã‚¼ãƒ­ã§ã§ããŸã“ã¨'] }
      ]
    };

    var slots = templates[strategy] || templates.PARADOX;
    var html = '';
    for (var i = 0; i < slots.length; i++) {
      var s = slots[i];
      html += '<div class="template-slot">';
      html += '<div class="slot-label">ã€' + s.label + 'ã€‘</div>';
      html += '<input type="text" class="slot-input" id="slot_' + i + '" placeholder="' + s.placeholder + '">';
      html += '<div class="hint-popup"><ul>';
      for (var h = 0; h < s.hints.length; h++) {
        html += '<li>' + s.hints[h] + '</li>';
      }
      html += '</ul></div></div>';
    }
    document.getElementById('templateSlots').innerHTML = html;
  }

  function reflectTemplateToMain() {
    var slots = document.querySelectorAll('.slot-input');
    var parts = [];
    for (var i = 0; i < slots.length; i++) {
      var v = slots[i].value.trim();
      if (v) parts.push(v);
    }
    if (parts.length > 0) {
      document.getElementById('mainPostEdit').value = parts.join('ã€‚') + 'ã€‚';
      updateMainPostCounter();
      showToast('ãƒ†ãƒ³ãƒ—ãƒ¬ã‹ã‚‰åæ˜ ã—ã¾ã—ãŸ', 'info');
    } else {
      showToast('ç©´åŸ‹ã‚ã«å…¥åŠ›ã—ã¦ã‹ã‚‰åæ˜ ã—ã¦ãã ã•ã„', 'error');
    }
  }

  // ============================================================
  // ãƒªãƒ—ãƒ©ã‚¤ç®¡ç†
  // ============================================================
  function addReplyBlock(initialText) {
    APP.replyCount++;
    var idx = APP.replyCount;
    var block = document.createElement('div');
    block.className = 'reply-block';
    block.id = 'reply_' + idx;
    block.innerHTML = '<div class="reply-header">' +
      '<span class="reply-label">ãƒªãƒ—' + idx + '</span>' +
      '<button class="btn-remove-reply" onclick="removeReply(' + idx + ')">Ã—</button>' +
      '</div>' +
      '<textarea class="input-field" id="replyText_' + idx + '" rows="3" placeholder="ãƒªãƒ—ãƒ©ã‚¤ã‚’å…¥åŠ›..." oninput="updateReplyCounter(' + idx + ')">' + (initialText || '') + '</textarea>' +
      '<div class="char-counter" id="replyCounter_' + idx + '">' + (initialText ? initialText.length : 0) + '/140</div>';
    document.getElementById('replyBlocks').appendChild(block);
  }

  function removeReply(idx) {
    var el = document.getElementById('reply_' + idx);
    if (el) el.remove();
  }

  function updateReplyCounter(idx) {
    var text = document.getElementById('replyText_' + idx).value;
    var counter = document.getElementById('replyCounter_' + idx);
    counter.textContent = text.length + '/140';
    counter.className = 'char-counter';
    if (text.length > 140) counter.className += ' over';
    else if (text.length > 130) counter.className += ' warn';
  }

  // ============================================================
  // ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½
  // ============================================================
  function copyPostText(idx) {
    if (APP.posts && APP.posts[idx]) {
      copyToClipboard(APP.posts[idx].text);
    }
  }

  function copyMainPost() {
    var text = document.getElementById('mainPostEdit').value;
    copyToClipboard(text);
  }

  function copyReply(idx) {
    var el = document.getElementById('replyText_' + (idx + 1));
    if (el) copyToClipboard(el.value);
  }

  function copyAllReplies() {
    var blocks = document.querySelectorAll('[id^="replyText_"]');
    var texts = [];
    for (var i = 0; i < blocks.length; i++) {
      if (blocks[i].value.trim()) texts.push(blocks[i].value.trim());
    }
    if (texts.length > 0) {
      copyToClipboard(texts.join('\n---\n'));
    }
  }

  function copyToClipboard(text) {
    if (!text) { showToast('ã‚³ãƒ”ãƒ¼ã™ã‚‹å†…å®¹ãŒã‚ã‚Šã¾ã›ã‚“', 'error'); return; }

    // æ–°ã—ã„Clipboard API
    if (navigator.clipboard && navigator.clipboard.writeText) {
      navigator.clipboard.writeText(text).then(function () {
        showToast('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼', 'success');
      }).catch(function () {
        fallbackCopy(text);
      });
    } else {
      fallbackCopy(text);
    }
  }

  function fallbackCopy(text) {
    var ta = document.createElement('textarea');
    ta.value = text;
    ta.style.position = 'fixed';
    ta.style.opacity = '0';
    document.body.appendChild(ta);
    ta.select();
    try {
      document.execCommand('copy');
      showToast('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼', 'success');
    } catch (e) {
      showToast('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
    }
    document.body.removeChild(ta);
  }

  // ============================================================
  // æˆ¦ç•¥ã‚¬ã‚¤ãƒ‰
  // ============================================================
  function renderStrategyGuide(guide) {
    if (!guide) return;
    var html = '<h4>ğŸ“Œ ' + APP.strategy + ' æˆ¦ç•¥ã‚¬ã‚¤ãƒ‰</h4>';
    html += '<div class="guide-item"><span class="emoji">ğŸ¯</span>KPIç›®å®‰ï¼š' + guide.kpi + '</div>';
    html += '<div class="guide-item"><span class="emoji">ğŸ“</span>æ§‹é€ ï¼š' + guide.structure + '</div>';
    html += '<div class="guide-item"><span class="emoji">â±</span>1åˆ†ãƒ«ãƒ¼ãƒãƒ³ï¼š' + guide.routine + '</div>';
    html += '<h4 class="mt-2" style="color:#FC8181;">ğŸš« ã‚„ã‚‹ãª3ã¤</h4>';
    for (var i = 0; i < guide.dontDo.length; i++) {
      html += '<div class="guide-item dont"><span class="emoji">âŒ</span>' + guide.dontDo[i] + '</div>';
    }
    html += '<div class="guide-item mt-1"><span class="emoji">ğŸ”„</span>A/Bå·®åˆ†ï¼šA=' + guide.abDiff.A + ' / B=' + guide.abDiff.B + '</div>';
    document.getElementById('strategyGuidePanel').innerHTML = html;
  }

  // ============================================================
  // è¾æ›¸
  // ============================================================
  function loadDictionary() {
    if (!APP.token) return;
    showLoading('è¾æ›¸èª­ã¿è¾¼ã¿ä¸­...');
    callApi('apiGetDictionary', { token: APP.token })
      .then(function (res) {
        hideLoading();
        if (!res.success) return;
        var d = res.dictionary;
        document.getElementById('dictFacts').value = d.facts || '';
        document.getElementById('dictNumbers').value = d.numbers || '';
        document.getElementById('dictEfforts').value = d.efforts || '';
        document.getElementById('dictEmotions').value = d.emotions || '';
        document.getElementById('dictAesthetics').value = d.aesthetics || '';
        document.getElementById('dictPunchline').value = d.punchline || '';
      })
      .catch(function () {
        hideLoading();
      });
  }

  function handleSaveDictionary() {
    showLoading('ä¿å­˜ä¸­...');
    var updates = {
      facts: document.getElementById('dictFacts').value.trim(),
      numbers: document.getElementById('dictNumbers').value.trim(),
      efforts: document.getElementById('dictEfforts').value.trim(),
      emotions: document.getElementById('dictEmotions').value.trim(),
      aesthetics: document.getElementById('dictAesthetics').value.trim(),
      punchline: document.getElementById('dictPunchline').value.trim()
    };

    callApi('apiUpdateDictionary', { token: APP.token, updates: updates })
      .then(function (res) {
        hideLoading();
        if (res.success) {
          showToast('è¾æ›¸ã‚’ä¿å­˜ã—ã¾ã—ãŸï¼', 'success');
        } else {
          showToast(res.message, 'error');
        }
      })
      .catch(function () {
        hideLoading();
        showToast('ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸã€‚', 'error');
      });
  }

  // ============================================================
  // Growth Console
  // ============================================================
  function loadGrowth() {
    if (!APP.token) return;
    callApi('apiGetDashboard', { token: APP.token })
      .then(function (res) {
        if (!res.success) return;
        document.getElementById('growthTotal').textContent = res.totalCount;
        document.getElementById('growthToday').textContent = res.todayCount;
      })
      .catch(function (err) {
        console.error('growth load error:', err);
      });
  }

  // ============================================================
  // ãƒ©ãƒ³ãƒ€ãƒ ãƒ’ãƒ³ãƒˆ
  // ============================================================
  var RANDOM_HINTS = [
    'ä¸€ç•ªæœ€åˆã«è«¦ã‚ã‹ã‘ãŸç¬é–“ã¯ï¼Ÿ',
    'ãã‚Œã§ã‚‚ç¶šã‘ãŸç†ç”±ã¯ï¼Ÿ',
    'èª°ã«ã‚‚è¨€ã£ã¦ã„ãªã„å¤±æ•—ã¯ï¼Ÿ',
    'ä¸€ç•ªå¬‰ã—ã‹ã£ãŸåå¿œã¯ï¼Ÿ',
    'ã‚‚ã†ä¸€åº¦ã‚„ã‚‹ãªã‚‰ä½•ã‚’å¤‰ãˆã‚‹ï¼Ÿ',
    'å§‹ã‚ãŸæ™‚ã€å‘¨ã‚Šã«ä½•ã¨è¨€ã‚ã‚ŒãŸï¼Ÿ',
    'ä¸€ç•ªãŠé‡‘ã‚’ã‹ã‘ãŸã“ã¨ã¯ï¼Ÿ',
    'å¤œä¸­ã«è€ƒãˆã¦ã—ã¾ã†ã“ã¨ã¯ï¼Ÿ',
    'æˆåŠŸã¨å¤±æ•—ã®åˆ†ã‹ã‚Œç›®ã¯ä½•ã ã£ãŸï¼Ÿ',
    '3ãƒ¶æœˆå‰ã®è‡ªåˆ†ã«ä¼ãˆãŸã„ã“ã¨ã¯ï¼Ÿ',
    'ä¸€ç•ªæ™‚é–“ã‚’ç„¡é§„ã«ã—ãŸã“ã¨ã¯ï¼Ÿ',
    'ã€Œã‚„ã‚ã‚ˆã†ã‹ãªã€ã¨æ€ã£ãŸå›æ•°ã¯ï¼Ÿ',
    'æ„å¤–ã¨åŠ¹æœãŒã‚ã£ãŸå°ã•ãªå·¥å¤«ã¯ï¼Ÿ'
  ];

  function showRandomHint() {
    var hint = RANDOM_HINTS[Math.floor(Math.random() * RANDOM_HINTS.length)];
    document.getElementById('randomHint').textContent = 'ğŸ’­ ' + hint;
  }

  // ============================================================
  // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
  // ============================================================
  function showLoading(text) {
    document.getElementById('loadingText').textContent = text || 'èª­ã¿è¾¼ã¿ä¸­...';
    document.getElementById('loadingOverlay').classList.remove('hidden');
  }

  function hideLoading() {
    document.getElementById('loadingOverlay').classList.add('hidden');
  }

  function showToast(message, type) {
    var toast = document.getElementById('toast');
    toast.textContent = message;
    toast.className = 'toast ' + (type || 'info');
    toast.classList.remove('hidden');
    setTimeout(function () {
      toast.classList.add('hidden');
    }, 3000);
  }

  function escapeHtml(text) {
    var div = document.createElement('div');
    div.textContent = text;
    return div.innerHTML;
  }
</script>

</body>

</html>